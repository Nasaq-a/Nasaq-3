<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أتمّ | لإتمام المهام</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Amiri:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --header-bg: #3E2723; /* بني داكن للجزء العلوي */
            --body-bg: #FDF5E6;   /* كريمي لباقي الصفحة */
            --accent: #D4AF37;    /* ذهبي */
            --text-main: #3E2723;
            --white: #ffffff;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: 'Cairo', sans-serif;
            background-color: var(--body-bg);
            color: var(--text-main);
            min-height: 100vh;
        }

        /* 1. الجزء العلوي */
        header {
            background-color: var(--header-bg);
            color: var(--accent);
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        header h1 {
            font-family: 'Amiri', serif;
            margin: 0;
            font-size: 2.5rem;
            letter-spacing: 2px;
        }

        /* 2. باقي الصفحة */
        .container {
            max-width: 500px;
            margin: 20px auto;
            padding: 0 15px;
        }

        /* أزرار التحكم */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .btn-circle {
            width: 55px; height: 55px;
            border-radius: 15px;
            border: 2px solid var(--accent);
            background: var(--header-bg);
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: 0.3s;
        }

        .btn-circle:hover { transform: scale(1.1); background: var(--accent); color: var(--header-bg); }

        /* عرض المهام */
        .task-card {
            background: var(--white);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-right: 6px solid var(--accent);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .task-card.locked {
            opacity: 0.6;
            background: #e0e0e0;
            border-right-color: #9e9e9e;
        }

        .task-info h3 { margin: 0; font-size: 1.1rem; }
        .task-info p { margin: 5px 0 0; font-size: 0.85rem; color: #777; }

        .task-actions { display: flex; align-items: center; gap: 15px; }

        .btn-check {
            width: 45px; height: 45px;
            border-radius: 10px;
            border: none;
            background: #4CAF50;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        .btn-check:disabled { background: #9e9e9e; cursor: not-allowed; }

        .streak-count { font-weight: bold; color: var(--header-bg); font-size: 0.9rem; }

        /* النافذة المنبثقة (Modal) */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: none; align-items: center; justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--body-bg);
            padding: 25px;
            border-radius: 20px;
            width: 90%; max-width: 400px;
            border: 3px solid var(--accent);
        }

        input, select {
            width: 100%; padding: 12px; margin: 10px 0;
            border-radius: 10px; border: 1px solid #ccc;
            font-family: 'Cairo', sans-serif;
        }

        .modal-btns { display: flex; gap: 10px; margin-top: 15px; }
        .btn-save { flex: 2; background: var(--header-bg); color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; }
        .btn-cancel { flex: 1; background: #ccc; border: none; padding: 10px; border-radius: 8px; cursor: pointer; }
        .btn-delete-task { width: 100%; background: #e57373; color: white; border: none; padding: 10px; border-radius: 8px; margin-top: 10px; cursor: pointer; }

    </style>
</head>
<body>

    <header>
        <h1>أتمّ</h1>
    </header>

    <div class="container">
        <div class="controls">
            <button class="btn-circle" onclick="openModal('add')" title="إضافة مهمة">+</button>
            <button class="btn-circle" onclick="toggleEditMode()" title="الإعدادات">⚙</button>
        </div>

        <div id="tasks-container">
            </div>
    </div>

    <div class="modal" id="task-modal">
        <div class="modal-content">
            <h2 id="modal-title" style="margin-top:0">إضافة مهمة</h2>
            <input type="text" id="task-name" placeholder="اسم المهمة أو الروتين...">
            <label>كم مرة تود تكرارها يومياً؟</label>
            <select id="task-target">
                <option value="1">مرة واحدة</option>
                <option value="2">مرتين</option>
                <option value="3">ثلاث مرات</option>
            </select>
            <div class="modal-btns">
                <button class="btn-save" onclick="saveTask()">حفظ</button>
                <button class="btn-cancel" onclick="closeModal()">إلغاء</button>
            </div>
            <button class="btn-delete-task" id="delete-btn" style="display:none" onclick="deleteTask()">حذف المهمة نهائياً</button>
        </div>
    </div>

<script>
    let tasks = JSON.parse(localStorage.getItem('atamm_tasks')) || [];
    let editMode = false;
    let currentEditIndex = null;

    // التحقق من اليوم (تصفير المهام اليومية)
    function checkNewDay() {
        const lastDate = localStorage.getItem('atamm_last_date');
        const today = new Date().toDateString();

        if (lastDate !== today) {
            tasks.forEach(task => {
                // إذا لم يكمل المهمة أمس، يصفر العداد التراكمي
                if (task.dailyCount < task.target) {
                    task.streak = 0;
                }
                task.dailyCount = 0; // تصفير عداد اليوم
                task.isLocked = false;
            });
            localStorage.setItem('atamm_last_date', today);
            saveData();
        }
    }

    function saveData() {
        localStorage.setItem('atamm_tasks', JSON.stringify(tasks));
        renderTasks();
    }

    function openModal(mode, index = null) {
        document.getElementById('task-modal').style.display = 'flex';
        if (mode === 'add') {
            document.getElementById('modal-title').innerText = "إضافة مهمة";
            document.getElementById('task-name').value = "";
            document.getElementById('delete-btn').style.display = "none";
            currentEditIndex = null;
        } else {
            document.getElementById('modal-title').innerText = "تعديل المهمة";
            document.getElementById('task-name').value = tasks[index].name;
            document.getElementById('task-target').value = tasks[index].target;
            document.getElementById('delete-btn').style.display = "block";
            currentEditIndex = index;
        }
    }

    function closeModal() { document.getElementById('task-modal').style.display = 'none'; }

    function saveTask() {
        const name = document.getElementById('task-name').value;
        const target = parseInt(document.getElementById('task-target').value);

        if (!name.trim()) return alert("يرجى كتابة اسم المهمة");

        if (currentEditIndex === null) {
            tasks.push({ name, target, dailyCount: 0, streak: 0, isLocked: false });
        } else {
            tasks[currentEditIndex].name = name;
            tasks[currentEditIndex].target = target;
        }
        closeModal();
        saveData();
    }

    function deleteTask() {
        if (confirm("هل أنت متأكد من حذف هذه المهمة؟")) {
            tasks.splice(currentEditIndex, 1);
            closeModal();
            saveData();
        }
    }

    function completeSession(index) {
        const task = tasks[index];
        if (task.isLocked) return;

        task.dailyCount++;
        
        if (task.dailyCount >= task.target) {
            task.isLocked = true;
            task.streak++; // زيادة عدد أيام الإنجاز
        }
        saveData();
    }

    function toggleEditMode() {
        editMode = !editMode;
        renderTasks();
    }

    function renderTasks() {
        const container = document.getElementById('tasks-container');
        container.innerHTML = '';

        tasks.forEach((task, i) => {
            const card = document.createElement('div');
            card.className = `task-card ${task.isLocked ? 'locked' : ''}`;
            
            card.innerHTML = `
                <div class="task-info">
                    <h3>${task.name}</h3>
                    <p>${task.isLocked ? 'تم إتمامها لليوم ✅' : `المتبقي اليوم: ${task.target - task.dailyCount}`}</p>
                </div>
                <div class="task-actions">
                    <span class="streak-count">${task.streak} يوم</span>
                    ${editMode ? 
                        `<button class="btn-check" style="background:#8B4513" onclick="openModal('edit', ${i})">⚙</button>` :
                        `<button class="btn-check" onclick="completeSession(${i})" ${task.isLocked ? 'disabled' : ''}>✓</button>`
                    }
                </div>
            `;
            container.appendChild(card);
        });
    }

    // التشغيل الأولي
    checkNewDay();
    renderTasks();
</script>

</body>
</html>
